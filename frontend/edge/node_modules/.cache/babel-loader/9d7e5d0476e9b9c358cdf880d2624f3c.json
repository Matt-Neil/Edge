{"ast":null,"code":"var _jsxFileName = \"/Users/matt/Documents/GitHub/Edge/frontend/edge/src/Pages/Dataset.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef, useContext } from 'react';\nimport { useHistory, useParams, Link } from \"react-router-dom\";\nimport usersAPI from '../API/users';\nimport itemsAPI from '../API/items';\nimport globalAPI from '../API/global';\nimport imageAPI from '../API/images';\nimport fileAPI from '../API/files';\nimport { OpenItemsContext } from '../Contexts/openItemsContext';\nimport BookmarkIcon from '@mui/icons-material/Bookmark';\nimport ThumbUpIcon from '@mui/icons-material/ThumbUp';\nimport VisibilityOffIcon from '@mui/icons-material/VisibilityOff';\nimport VisibilityIcon from '@mui/icons-material/Visibility';\nimport CloseIcon from '@mui/icons-material/Close';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Dataset = _ref => {\n  _s();\n\n  let {\n    currentUser,\n    type\n  } = _ref;\n  const [stage, setStage] = useState(\"model\");\n  const [title, setTitle] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [visibility, setVisibility] = useState(false);\n  const [bookmarked, setBookmarked] = useState();\n  const [upvoted, setUpvoted] = useState();\n  const [upvotes, setUpvotes] = useState();\n  const [updated, setUpdated] = useState();\n  const [picture, setPicture] = useState();\n  const [date, setDate] = useState(\"\");\n  const [start, setStart] = useState(0);\n  const [end, setEnd] = useState(30);\n  const [page, setPage] = useState(1);\n  const [image, setImage] = useState();\n  const [dataset, setDataset] = useState([]);\n  const [labels, setLabels] = useState([]);\n  const [changedSettings, setChangedSettings] = useState(false);\n  const [changedData, setChangedData] = useState(false);\n  const [uploadedImages, setUploadedImages] = useState([]);\n  const [imageFiles, setImageFiles] = useState([]);\n  const [assignedLabels, setAssignedLabels] = useState([]);\n  const [refreshData, setRefreshData] = useState();\n  const [refreshLabels, setRefreshLabels] = useState();\n  const [loaded, setLoaded] = useState(false);\n  const [exist, setExist] = useState();\n  const [noData, setNoData] = useState();\n  const [addLabel, setAddLabel] = useState(\"\");\n  const [disableCreate, setDisabledCreate] = useState(false);\n  const {\n    addOpenItems,\n    removeOpenItems\n  } = useContext(OpenItemsContext);\n  const modelRef = useRef(null);\n  const datasetID = useParams().id;\n  const publicInterval = useRef(0);\n  const existInterval = useRef(0);\n  const history = useHistory();\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        if (type === \"create\") {\n          const dataset = await usersAPI.get(\"/created?type=dataset\");\n          dataset.data.data.map(dataset => {\n            setDataset(previous => [...previous, dataset.title]);\n          });\n          setLoaded(true);\n        } else {\n          const dataset = await itemsAPI.get(`/${datasetID}?type=dataset`);\n\n          if (dataset.data.data.creator === currentUser.id) {\n            addOpenItems(dataset.data.data._id, dataset.data.data.title, dataset.data.data.type);\n          }\n\n          setDataset(dataset.data.data);\n          setUpdated(dataset.data.data.updated);\n          setBookmarked(dataset.data.data.bookmarked);\n          setUpvoted(dataset.data.data.upvoted);\n          setPicture(dataset.data.data.picture);\n          setUpvotes(dataset.data.data.upvotes);\n          setVisibility(dataset.data.data.visibility);\n          setTitle(dataset.data.data.title);\n          setDescription(dataset.data.data.description);\n          setLabels(dataset.data.data.labels);\n          fetch(`http://127.0.0.1:5000/files/${dataset.data.data.imageFile}/labels.json`).then(response => response.json()).then(images => {\n            images.map(image => {\n              setUploadedImages(state => [...state, image.filename]);\n              setAssignedLabels(state => [...state, image.label]);\n            });\n            setExist(true);\n            setLoaded(true);\n          }).catch(() => {\n            setExist(true);\n            setLoaded(true);\n          });\n        }\n      } catch (err) {\n        setExist(false);\n        setLoaded(true);\n      }\n    };\n\n    fetchData();\n  }, []);\n  useEffect(() => {\n    if (loaded && exist) {\n      const updatedDate = new Date(updated);\n      const currentDate = new Date();\n\n      if ((currentDate.getTime() - updatedDate.getTime()) / (1000 * 3600 * 24) >= 365) {\n        setDate(`Updated ${Math.floor((currentDate.getTime() - updatedDate.getTime()) / (1000 * 3600 * 24) % 365).toString()} years ago`);\n      } else if ((currentDate.getTime() - updatedDate.getTime()) / (1000 * 3600 * 24) >= 30) {\n        setDate(`Updated ${Math.floor(((currentDate.getTime() - updatedDate.getTime()) / (1000 * 3600 * 24) % 30).toString())} months ago`);\n      } else if ((currentDate.getTime() - updatedDate.getTime()) / (1000 * 3600 * 24) >= 1) {\n        setDate(`Updated ${Math.floor((currentDate.getTime() - updatedDate.getTime()) / (1000 * 3600 * 24)).toString()} days ago`);\n      } else if ((currentDate.getTime() - updatedDate.getTime()) / (1000 * 3600) >= 1) {\n        setDate(`Updated ${Math.floor((currentDate.getTime() - updatedDate.getTime()) / (1000 * 3600)).toString()} hours ago`);\n      } else if ((currentDate.getTime() - updatedDate.getTime()) / (1000 * 60) >= 1) {\n        setDate(`Updated ${Math.floor((currentDate.getTime() - updatedDate.getTime()) / (1000 * 60)).toString()} minutes ago`);\n      } else {\n        setDate(\"Updated just now\");\n      }\n    }\n  }, [loaded, updated]);\n\n  const addFunctionKey = e => {\n    if (e.key === \"Enter\" && addLabel !== \"\") {\n      setLabels(state => [...state, addLabel]);\n      setAddLabel(\"\");\n    }\n  };\n\n  const updateUpvote = async () => {\n    try {\n      await globalAPI.put(`/upvote/${datasetID}?state=${upvoted}`);\n\n      if (upvoted) {\n        setUpvotes(state => state - 1);\n      } else {\n        setUpvotes(state => state + 1);\n      }\n\n      setUpvoted(state => !state);\n    } catch (err) {}\n  };\n\n  const updateBookmark = async () => {\n    try {\n      await globalAPI.put(`/bookmark/${datasetID}?state=${bookmarked}`);\n      setBookmarked(state => !state);\n    } catch (err) {}\n  };\n\n  const updateVisibility = async () => {\n    try {\n      await globalAPI.put(`/visibility/${datasetID}`);\n      setVisibility(state => !state);\n    } catch (err) {}\n  };\n\n  const previousPage = () => {\n    if (page > 1) {\n      setStart((page - 2) * 30);\n      setEnd((page - 1) * 30);\n      setPage(state => state - 1);\n      setRefreshData(new Date().getTime());\n    }\n  };\n\n  const nextPage = () => {\n    if (page * 30 < uploadedImages.length && uploadedImages.length > 30) {\n      setPage(state => state + 1);\n      setStart(page * 30);\n      setEnd((page + 1) * 30);\n      setRefreshData(new Date().getTime());\n    }\n  };\n\n  const replaceImages = () => {\n    if (type === \"create\") {\n      setUploadedImages(imageFiles);\n    } else {\n      setUploadedImages(imageFiles);\n    }\n\n    setAssignedLabels(Array(imageFiles).fill(\"No label\"));\n    setPage(1);\n    setRefreshData(new Date().getTime());\n    setImageFiles([]);\n  };\n\n  const appendImages = () => {\n    if (type === \"create\") {} else {}\n\n    setAssignedLabels(state => [...state, Array(imageFiles).fill(\"No label\")]);\n    setUploadedImages(state => [...state]);\n    setPage(1);\n    setRefreshData(new Date().getTime());\n    setImageFiles([]);\n  };\n\n  const updateDataset = async () => {\n    if (image) {\n      const formImage = new FormData();\n      formImage.append('image', image);\n\n      try {\n        const tempPicture = picture;\n        const imageResponse = await imageAPI.post(\"/upload\", formImage);\n        await itemsAPI.put(`/${datasetID}?type=dataset`, {\n          title: title,\n          description: description,\n          picture: imageResponse.data.data,\n          labels: labels,\n          updated: new Date().toISOString()\n        });\n        setImage(undefined);\n        setPicture(imageResponse.data.data);\n\n        if (tempPicture !== \"default.png\") {\n          await imageAPI.put('/remove', {\n            picture: tempPicture\n          });\n        }\n      } catch (err) {}\n    } else {\n      try {\n        await itemsAPI.put(`/${datasetID}?type=dataset`, {\n          title: title,\n          description: description,\n          picture: picture,\n          labels: labels,\n          updated: new Date().toISOString()\n        });\n      } catch (err) {}\n    }\n\n    setUpdated(new Date().toISOString());\n    setChangedSettings(false);\n  };\n\n  const deleteDataset = async () => {\n    try {\n      await itemsAPI.delete(`/${datasetID}`);\n      removeOpenItems(datasetID);\n      history.replace(\"/home\");\n    } catch (err) {}\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: loaded && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"main-body\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"sidebar\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"sidebar-header\",\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: \"http://localhost:3000/dataset.png\",\n            className: !(type === \"view\" && !dataset.self) ? \"create-item-edit-image\" : undefined\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 260,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            className: `create-item-title ${!(type === \"view\" && !dataset.self) && \"create-item-edit-input\"}`,\n            placeholder: \"Title\",\n            onChange: e => {\n              setTitle(e.target.value);\n              setChangedSettings(true);\n            },\n            disabled: !(dataset.self || type === \"create\"),\n            value: title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 262,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 259,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          className: `create-item-description ${!(type === \"view\" && !dataset.self) && \"create-item-edit-textarea\"}`,\n          placeholder: \"Description\",\n          onChange: e => {\n            setDescription(e.target.value);\n            setChangedSettings(true);\n          },\n          disabled: !(dataset.self || type === \"create\"),\n          value: description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 271,\n          columnNumber: 25\n        }, this), (dataset.self || type === \"create\") && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"create-item-setup\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"create-item-setup-label\",\n              children: \"Picture\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 282,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"create-item-setup-input\",\n              type: \"file\",\n              name: \"image\",\n              onChange: e => {\n                setImage(e.target.files[0]);\n                setChangedSettings(true);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 283,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 281,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"create-item-setup\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"create-item-setup-label\",\n              children: \"Public?\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 292,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"checkbox\",\n              onChange: () => {\n                setVisibility(previous => !previous);\n                setChangedSettings(true);\n              },\n              checked: visibility\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 293,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 291,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true), !dataset.self && type !== \"create\" && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"item-creator\",\n          children: dataset.creatorName.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 302,\n          columnNumber: 64\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"item-information\",\n          children: [type !== \"create\" && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"item-date\",\n            children: date\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 304,\n            columnNumber: 51\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 305,\n            columnNumber: 29\n          }, this), !dataset.self && type !== \"create\" && /*#__PURE__*/_jsxDEV(BookmarkIcon, {\n            className: `item-icon ${bookmarked ? \"blue2\" : \"white\"}`,\n            onClick: () => {\n              updateBookmark();\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 306,\n            columnNumber: 68\n          }, this), dataset.self && type !== \"create\" && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: visibility ? /*#__PURE__*/_jsxDEV(VisibilityIcon, {\n              className: \"item-visibility\",\n              onClick: () => {\n                updateVisibility();\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 310,\n              columnNumber: 41\n            }, this) : /*#__PURE__*/_jsxDEV(VisibilityOffIcon, {\n              className: \"item-visibility\",\n              onClick: () => {\n                updateVisibility();\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 312,\n              columnNumber: 41\n            }, this)\n          }, void 0, false), type !== \"create\" && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(ThumbUpIcon, {\n              className: `item-icon ${upvoted ? \"blue2\" : \"white\"}`,\n              onClick: () => {\n                updateUpvote();\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 318,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: upvoted ? \"blue2\" : \"white\",\n              children: upvotes\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 319,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 303,\n          columnNumber: 25\n        }, this), type === \"view\" && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"sidebar-divided\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 325,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Associated Workspaces:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 326,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true), type === \"view\" && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: dataset.self && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"sidebar-divided\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 333,\n              columnNumber: 41\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"blue-button item-save\",\n              disabled: !changedSettings,\n              onClick: () => {\n                updateDataset();\n              },\n              children: \"Save Changes\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 334,\n              columnNumber: 41\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"text-button item-delete\",\n              onClick: () => {\n                deleteDataset();\n              },\n              children: \"Delete\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 337,\n              columnNumber: 41\n            }, this)]\n          }, void 0, true)\n        }, void 0, false)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"inner\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"workspace-body\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"workspace-inner\",\n            children: type === \"create\" || dataset.self ? /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"view-items-top\",\n                children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n                  children: \"Create Dataset\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 350,\n                  columnNumber: 45\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 351,\n                  columnNumber: 45\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"blue-button\",\n                  disabled: disableCreate,\n                  onClick: () => {},\n                  children: \"Create\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 352,\n                  columnNumber: 45\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"create-dataset-upload\",\n                  children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                    type: \"file\",\n                    name: \"data\",\n                    accept: \"image/*\",\n                    multiple: true,\n                    onChange: e => {\n                      setImageFiles(e.target.files);\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 357,\n                    columnNumber: 45\n                  }, this), type === \"create\" && uploadedImages.length === 0 && /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"white-button\",\n                    children: \"Add\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 365,\n                    columnNumber: 49\n                  }, this), (dataset.self || type === \"create\") && uploadedImages.length !== 0 && /*#__PURE__*/_jsxDEV(_Fragment, {\n                    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                      className: \"white-button\",\n                      children: \"Replace\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 369,\n                      columnNumber: 53\n                    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                      className: \"white-button\",\n                      children: \"Update\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 370,\n                      columnNumber: 53\n                    }, this)]\n                  }, void 0, true)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 356,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 349,\n                columnNumber: 41\n              }, this), type === \"create\" && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"create-dataset-images-list\",\n                children: [...imageFiles].map((image, i) => {\n                  if (i >= start && i < end) {\n                    return /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"create-dataset-image\",\n                      children: /*#__PURE__*/_jsxDEV(\"div\", {\n                        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                          src: URL.createObjectURL(image)\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 382,\n                          columnNumber: 69\n                        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n                          value: assignedLabels[i],\n                          onChange: e => {\n                            setAssignedLabels(state => {\n                              const stateCopy = [...state];\n                              stateCopy[i] = e.target.value;\n                              return stateCopy;\n                            });\n                            setRefreshLabels(new Date().getTime());\n                          },\n                          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                            value: \"No label\",\n                            children: \"No label\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 392,\n                            columnNumber: 73\n                          }, this), labels.map((label, j) => /*#__PURE__*/_jsxDEV(\"option\", {\n                            value: label,\n                            children: label\n                          }, j, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 394,\n                            columnNumber: 77\n                          }, this))]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 383,\n                          columnNumber: 69\n                        }, this)]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 381,\n                        columnNumber: 65\n                      }, this)\n                    }, i, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 380,\n                      columnNumber: 61\n                    }, this);\n                  }\n                })\n              }, refreshData, false, {\n                fileName: _jsxFileName,\n                lineNumber: 376,\n                columnNumber: 45\n              }, this)]\n            }, void 0, true) : /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"create-dataset-images-list\",\n              children: uploadedImages.map((image, i) => {\n                if (i >= start && i < end) {\n                  return /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"item-dataset-image\",\n                    children: /*#__PURE__*/_jsxDEV(\"div\", {\n                      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                        src: `http://127.0.0.1:5000/files/${dataset.imageFile}/${image}.jpg`\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 412,\n                        columnNumber: 61\n                      }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n                        value: assignedLabels[i],\n                        onChange: e => {\n                          setAssignedLabels(state => {\n                            const stateCopy = [...state];\n                            stateCopy[i] = e.target.value;\n                            return stateCopy;\n                          });\n                          setRefreshLabels(new Date().getTime());\n                        },\n                        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                          value: \"No label\",\n                          children: \"No label\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 422,\n                          columnNumber: 65\n                        }, this), labels.map((label, j) => /*#__PURE__*/_jsxDEV(\"option\", {\n                          value: label,\n                          children: label\n                        }, j, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 424,\n                          columnNumber: 69\n                        }, this))]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 413,\n                        columnNumber: 61\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 411,\n                      columnNumber: 57\n                    }, this)\n                  }, i, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 410,\n                    columnNumber: 53\n                  }, this);\n                }\n              })\n            }, refreshData, false, {\n              fileName: _jsxFileName,\n              lineNumber: 406,\n              columnNumber: 37\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 346,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"create-workspace-data\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"create-workspace-data-header\",\n              children: \"Labels:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 436,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"sidebar-divided\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 437,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"create-dataset-label-input\",\n              placeholder: \"Add Label\",\n              onChange: e => {\n                setAddLabel(e.target.value);\n              },\n              onKeyPress: addFunctionKey,\n              value: addLabel\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 438,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"create-dataset-labels-list\",\n              children: labels.map((label, i) => {\n                return /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"create-dataset-label\",\n                  children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                    children: label\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 447,\n                    columnNumber: 49\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    onClick: () => {\n                      assignedLabels.map((assignedLabel, j) => {\n                        if (assignedLabel === labels[i]) {\n                          setAssignedLabels(state => {\n                            const stateCopy = [...state];\n                            stateCopy[j] = \"No label\";\n                            return stateCopy;\n                          });\n                        }\n                      });\n                      labels.splice(i, 1);\n                      setRefreshLabels(new Date().getTime());\n                    },\n                    children: /*#__PURE__*/_jsxDEV(CloseIcon, {\n                      className: \"create-dataset-label-icon\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 463,\n                      columnNumber: 53\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 448,\n                    columnNumber: 49\n                  }, this)]\n                }, i, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 446,\n                  columnNumber: 45\n                }, this);\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 443,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 435,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 345,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 344,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 17\n    }, this)\n  }, void 0, false);\n};\n\n_s(Dataset, \"MOlts1BGwAsIaHYCsEtNXU6YD9A=\", false, function () {\n  return [useParams, useHistory];\n});\n\n_c = Dataset;\nexport default Dataset;\n\nvar _c;\n\n$RefreshReg$(_c, \"Dataset\");","map":{"version":3,"sources":["/Users/matt/Documents/GitHub/Edge/frontend/edge/src/Pages/Dataset.jsx"],"names":["React","useState","useEffect","useRef","useContext","useHistory","useParams","Link","usersAPI","itemsAPI","globalAPI","imageAPI","fileAPI","OpenItemsContext","BookmarkIcon","ThumbUpIcon","VisibilityOffIcon","VisibilityIcon","CloseIcon","Dataset","currentUser","type","stage","setStage","title","setTitle","description","setDescription","visibility","setVisibility","bookmarked","setBookmarked","upvoted","setUpvoted","upvotes","setUpvotes","updated","setUpdated","picture","setPicture","date","setDate","start","setStart","end","setEnd","page","setPage","image","setImage","dataset","setDataset","labels","setLabels","changedSettings","setChangedSettings","changedData","setChangedData","uploadedImages","setUploadedImages","imageFiles","setImageFiles","assignedLabels","setAssignedLabels","refreshData","setRefreshData","refreshLabels","setRefreshLabels","loaded","setLoaded","exist","setExist","noData","setNoData","addLabel","setAddLabel","disableCreate","setDisabledCreate","addOpenItems","removeOpenItems","modelRef","datasetID","id","publicInterval","existInterval","history","fetchData","get","data","map","previous","creator","_id","fetch","imageFile","then","response","json","images","state","filename","label","catch","err","updatedDate","Date","currentDate","getTime","Math","floor","toString","addFunctionKey","e","key","updateUpvote","put","updateBookmark","updateVisibility","previousPage","nextPage","length","replaceImages","Array","fill","appendImages","updateDataset","formImage","FormData","append","tempPicture","imageResponse","post","toISOString","undefined","deleteDataset","delete","replace","self","target","value","files","creatorName","name","i","URL","createObjectURL","stateCopy","j","assignedLabel","splice"],"mappings":"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","sourcesContent":["import React, {useState, useEffect, useRef, useContext} from 'react'\nimport {useHistory, useParams, Link} from \"react-router-dom\"\nimport usersAPI from '../API/users'\nimport itemsAPI from '../API/items'\nimport globalAPI from '../API/global'\nimport imageAPI from '../API/images'\nimport fileAPI from '../API/files'\nimport { OpenItemsContext } from '../Contexts/openItemsContext';\nimport BookmarkIcon from '@mui/icons-material/Bookmark';\nimport ThumbUpIcon from '@mui/icons-material/ThumbUp';\nimport VisibilityOffIcon from '@mui/icons-material/VisibilityOff';\nimport VisibilityIcon from '@mui/icons-material/Visibility';\nimport CloseIcon from '@mui/icons-material/Close';\n\nconst Dataset = ({currentUser, type}) => {\n    const [stage, setStage] = useState(\"model\");\n    const [title, setTitle] = useState(\"\");\n    const [description, setDescription] = useState(\"\");\n    const [visibility, setVisibility] = useState(false);\n    const [bookmarked, setBookmarked] = useState()\n    const [upvoted, setUpvoted] = useState()\n    const [upvotes, setUpvotes] = useState()\n    const [updated, setUpdated] = useState()\n    const [picture, setPicture] = useState()\n    const [date, setDate] = useState(\"\")\n    const [start, setStart] = useState(0)\n    const [end, setEnd] = useState(30)\n    const [page, setPage] = useState(1)\n    const [image, setImage] = useState();\n    const [dataset, setDataset] = useState([]);\n    const [labels, setLabels] = useState([])\n    const [changedSettings, setChangedSettings] = useState(false)\n    const [changedData, setChangedData] = useState(false)\n    const [uploadedImages, setUploadedImages] = useState([])\n    const [imageFiles, setImageFiles] = useState([])\n    const [assignedLabels, setAssignedLabels] = useState([])\n    const [refreshData, setRefreshData] = useState()\n    const [refreshLabels, setRefreshLabels] = useState()\n    const [loaded, setLoaded] = useState(false);\n    const [exist, setExist] = useState()\n    const [noData, setNoData] = useState()\n    const [addLabel, setAddLabel] = useState(\"\")\n    const [disableCreate, setDisabledCreate] = useState(false)\n    const {addOpenItems, removeOpenItems} = useContext(OpenItemsContext);\n    const modelRef = useRef(null)\n    const datasetID = useParams().id;\n    const publicInterval = useRef(0)\n    const existInterval = useRef(0)\n    const history = useHistory();\n\n    useEffect(() => {\n        const fetchData = async () => {\n            try {\n                if (type === \"create\") {\n                    const dataset = await usersAPI.get(\"/created?type=dataset\");\n    \n                    dataset.data.data.map((dataset) => {\n                        setDataset(previous => [...previous, dataset.title]);\n                    })\n\n                    setLoaded(true)\n                } else {\n                    const dataset = await itemsAPI.get(`/${datasetID}?type=dataset`);\n\n                    if (dataset.data.data.creator === currentUser.id) {\n                        addOpenItems(dataset.data.data._id, dataset.data.data.title, dataset.data.data.type)\n                    }\n\n                    setDataset(dataset.data.data);\n                    setUpdated(dataset.data.data.updated);\n                    setBookmarked(dataset.data.data.bookmarked)\n                    setUpvoted(dataset.data.data.upvoted)\n                    setPicture(dataset.data.data.picture)\n                    setUpvotes(dataset.data.data.upvotes)\n                    setVisibility(dataset.data.data.visibility)\n                    setTitle(dataset.data.data.title)\n                    setDescription(dataset.data.data.description)\n                    setLabels(dataset.data.data.labels)\n\n                    fetch(`http://127.0.0.1:5000/files/${dataset.data.data.imageFile}/labels.json`)\n                        .then(response => response.json())\n                        .then(images => {\n                            images.map(image => {\n                                setUploadedImages(state => [...state, image.filename])\n                                setAssignedLabels(state => [...state, image.label])\n                            })\n                            setExist(true)\n                            setLoaded(true)\n                        }).catch(() => {\n                            setExist(true)\n                            setLoaded(true)\n                        });\n                }\n            } catch (err) {\n              setExist(false)\n              setLoaded(true)\n            }\n        }\n        fetchData();\n    }, [])\n\n    useEffect(() => {\n        if (loaded && exist) {\n            const updatedDate = new Date(updated);\n            const currentDate = new Date();\n    \n            if ((currentDate.getTime() - updatedDate.getTime()) / (1000 * 3600 * 24) >= 365) {\n                setDate(`Updated ${Math.floor(((currentDate.getTime() - updatedDate.getTime()) / (1000 * 3600 * 24) % 365)).toString()} years ago`)\n            } else if ((currentDate.getTime() - updatedDate.getTime()) / (1000 * 3600 * 24) >= 30) {\n                setDate(`Updated ${Math.floor(((currentDate.getTime() - updatedDate.getTime()) / (1000 * 3600 * 24) % 30).toString())} months ago`)\n            } else if ((currentDate.getTime() - updatedDate.getTime()) / (1000 * 3600 * 24) >= 1) {\n                setDate(`Updated ${Math.floor(((currentDate.getTime() - updatedDate.getTime()) / (1000 * 3600 * 24))).toString()} days ago`)\n            } else if ((currentDate.getTime() - updatedDate.getTime()) / (1000 * 3600) >= 1) {\n                setDate(`Updated ${Math.floor(((currentDate.getTime() - updatedDate.getTime()) / (1000 * 3600))).toString()} hours ago`)\n            } else if ((currentDate.getTime() - updatedDate.getTime()) / (1000 * 60) >= 1) {\n                setDate(`Updated ${Math.floor(((currentDate.getTime() - updatedDate.getTime()) / (1000 * 60))).toString()} minutes ago`)\n            } else {\n                setDate(\"Updated just now\")\n            }\n        }\n    }, [loaded, updated])\n\n    const addFunctionKey = (e) => {\n        if (e.key === \"Enter\" && addLabel !== \"\") {\n            setLabels(state => [...state, addLabel])\n            setAddLabel(\"\")\n        }\n    }\n\n    const updateUpvote = async () => {\n        try {\n            await globalAPI.put(`/upvote/${datasetID}?state=${upvoted}`);\n\n            if (upvoted) {\n                setUpvotes(state => state-1)\n            } else {\n                setUpvotes(state => state+1)\n            }\n\n            setUpvoted(state => !state)\n        } catch (err) {}\n    }\n\n    const updateBookmark = async () => {\n        try {\n            await globalAPI.put(`/bookmark/${datasetID}?state=${bookmarked}`);\n            \n            setBookmarked(state => !state)\n        } catch (err) {}\n    }\n\n    const updateVisibility = async () => {\n        try {\n            await globalAPI.put(`/visibility/${datasetID}`);\n\n            setVisibility(state => !state)\n        } catch (err) {}\n    }\n\n    const previousPage = () => {\n        if (page > 1) {\n            setStart((page-2)*30)\n            setEnd((page-1)*30)\n            setPage(state => state-1)\n            setRefreshData(new Date().getTime())\n        }\n    }\n    \n    const nextPage = () => {\n        if (page*30 < uploadedImages.length && uploadedImages.length > 30) {\n            setPage(state => state+1)\n            setStart((page)*30)\n            setEnd((page+1)*30)\n            setRefreshData(new Date().getTime())\n        }\n    }\n\n    const replaceImages = () => {\n        if (type === \"create\") {\n            setUploadedImages(imageFiles)\n        } else {\n            setUploadedImages(imageFiles)\n        }\n\n        setAssignedLabels(Array(imageFiles).fill(\"No label\"))\n        setPage(1)\n        setRefreshData(new Date().getTime())\n        setImageFiles([])\n    }\n    \n    const appendImages = () => {\n        if (type === \"create\") {\n            \n        } else {\n\n        }\n\n        setAssignedLabels(state => [...state, Array(imageFiles).fill(\"No label\")])\n        setUploadedImages(state => [...state, ])\n        setPage(1)\n        setRefreshData(new Date().getTime())\n        setImageFiles([])\n    }\n\n    const updateDataset = async () => {\n        if (image) {\n            const formImage = new FormData();\n            formImage.append('image', image);\n            \n            try {\n                const tempPicture = picture\n                const imageResponse = await imageAPI.post(\"/upload\", formImage);\n\n                await itemsAPI.put(`/${datasetID}?type=dataset`, {\n                  title: title,\n                  description: description,\n                  picture: imageResponse.data.data,\n                  labels: labels,\n                  updated: new Date().toISOString()\n              })\n\n                setImage(undefined)\n                setPicture(imageResponse.data.data)\n\n                if (tempPicture !== \"default.png\") {\n                    await imageAPI.put('/remove', {picture: tempPicture});\n                }\n            } catch (err) {}\n        } else {\n            try {\n                await itemsAPI.put(`/${datasetID}?type=dataset`, {\n                  title: title,\n                  description: description,\n                  picture: picture,\n                  labels: labels,\n                  updated: new Date().toISOString()\n              })\n            } catch (err) {}\n        }\n\n        setUpdated(new Date().toISOString())\n        setChangedSettings(false)\n    }\n\n    const deleteDataset = async () => {\n        try {\n            await itemsAPI.delete(`/${datasetID}`)\n\n            removeOpenItems(datasetID)\n            history.replace(\"/home\")\n        } catch (err) {}\n    }\n\n    return (\n        <>\n            {loaded &&\n                <div className=\"main-body\">\n                    <div className=\"sidebar\">\n                        <div className=\"sidebar-header\">\n                            <img src=\"http://localhost:3000/dataset.png\"\n                                    className={!(type === \"view\" && !dataset.self) ? \"create-item-edit-image\" : undefined} />\n                            <input className={`create-item-title ${!(type === \"view\" && !dataset.self) && \"create-item-edit-input\"}`}\n                                    placeholder=\"Title\"\n                                    onChange={e => {\n                                        setTitle(e.target.value)\n                                        setChangedSettings(true)\n                                    }}\n                                    disabled={!(dataset.self || type === \"create\")}\n                                    value={title} />\n                        </div>\n                        <textarea className={`create-item-description ${!(type === \"view\" && !dataset.self) && \"create-item-edit-textarea\"}`}\n                                    placeholder=\"Description\"\n                                    onChange={e => {\n                                        setDescription(e.target.value)\n                                        setChangedSettings(true)\n                                    }}\n                                    disabled={!(dataset.self || type === \"create\")}\n                                    value={description} />\n                        {(dataset.self || type === \"create\") &&\n                            <>\n                                <div className=\"create-item-setup\">\n                                    <label className=\"create-item-setup-label\">Picture</label>\n                                    <input className=\"create-item-setup-input\"\n                                            type=\"file\" \n                                            name=\"image\" \n                                            onChange={e => {\n                                                setImage(e.target.files[0])\n                                                setChangedSettings(true)\n                                            }} />\n                                </div>\n                                <div className=\"create-item-setup\">\n                                    <label className=\"create-item-setup-label\">Public?</label>\n                                    <input type=\"checkbox\" \n                                            onChange={() => {\n                                                setVisibility(previous => !previous)\n                                                setChangedSettings(true)\n                                            }}\n                                            checked={visibility} />\n                                </div>\n                            </>\n                        }\n                        {!dataset.self && type !== \"create\" && <p className=\"item-creator\">{dataset.creatorName.name}</p>}\n                        <div className=\"item-information\">\n                            {type !== \"create\" && <p className=\"item-date\">{date}</p>}\n                            <span />\n                            {!dataset.self && type !== \"create\" && <BookmarkIcon className={`item-icon ${bookmarked ? \"blue2\" : \"white\"}`} onClick={() => {updateBookmark()}} />}\n                            {dataset.self && type !== \"create\" && \n                                <>\n                                    {visibility ? \n                                        <VisibilityIcon className=\"item-visibility\" onClick={() => {updateVisibility()}} />\n                                    :\n                                        <VisibilityOffIcon className=\"item-visibility\" onClick={() => {updateVisibility()}} />\n                                    }\n                                </>\n                            }\n                            {type !== \"create\" &&\n                                <>\n                                    <ThumbUpIcon className={`item-icon ${upvoted ? \"blue2\" : \"white\"}`} onClick={() => {updateUpvote()}} />\n                                    <p className={upvoted ? \"blue2\" : \"white\"}>{upvotes}</p>\n                                </>\n                            }\n                        </div>\n                        {type === \"view\" &&\n                            <>\n                                <div className=\"sidebar-divided\" />\n                                <p>Associated Workspaces:</p>\n                            </>\n                        }\n                        {type === \"view\" &&\n                            <>\n                                {dataset.self &&\n                                    <>\n                                        <div className=\"sidebar-divided\" />\n                                        <button className=\"blue-button item-save\"\n                                                disabled={!changedSettings}\n                                                onClick={() => {updateDataset()}}>Save Changes</button>\n                                        <button className=\"text-button item-delete\"\n                                                onClick={() => {deleteDataset()}}>Delete</button>\n                                    </>\n                                }\n                            </>\n                        }\n                    </div>\n                    <div className=\"inner\">\n                        <div className=\"workspace-body\">\n                            <div className=\"workspace-inner\">\n                                {(type === \"create\" || dataset.self) ?\n                                    <>\n                                        <div className=\"view-items-top\">\n                                            <h1>Create Dataset</h1>\n                                            <span />\n                                            <button className=\"blue-button\"\n                                                    disabled={disableCreate}\n                                                    onClick={() => {}}>Create</button>\n\n                                        <div className=\"create-dataset-upload\">\n                                            <input type=\"file\" \n                                                    name=\"data\"\n                                                    accept=\"image/*\"\n                                                    multiple\n                                                    onChange={e => {\n                                                        setImageFiles(e.target.files)\n                                                    }} />\n                                            {type === \"create\" && uploadedImages.length === 0 && \n                                                <button className=\"white-button\">Add</button>\n                                            }\n                                            {(dataset.self || type === \"create\") && uploadedImages.length !== 0 && \n                                                <>\n                                                    <button className=\"white-button\">Replace</button>\n                                                    <button className=\"white-button\">Update</button>\n                                                </>\n                                            }\n                                        </div>\n                                        </div>\n                                        {type === \"create\" &&\n                                            <div className=\"create-dataset-images-list\" key={refreshData}>\n                                                {[...imageFiles].map((image, i) => {\n                                                    if (i >= start && i < end) {\n                                                        return (\n                                                            <div className=\"create-dataset-image\" key={i}>\n                                                                <div>\n                                                                    <img src={URL.createObjectURL(image)} />\n                                                                    <select value={assignedLabels[i]}\n                                                                            onChange={e => {setAssignedLabels(state => {\n                                                                                        const stateCopy = [...state]\n                                                                                    \n                                                                                        stateCopy[i] = e.target.value\n                                                                                    \n                                                                                        return stateCopy\n                                                                                    })\n                                                                                    setRefreshLabels(new Date().getTime())}}>\n                                                                        <option value=\"No label\">No label</option>\n                                                                        {labels.map((label, j) => \n                                                                            <option value={label} key={j}>{label}</option>\n                                                                        )}\n                                                                    </select>\n                                                                </div>\n                                                            </div>\n                                                        )\n                                                    }\n                                                })}\n                                            </div>\n                                        }\n                                    </>\n                                :\n                                    <div className=\"create-dataset-images-list\" key={refreshData}>\n                                        {uploadedImages.map((image, i) => {\n                                            if (i >= start && i < end) {\n                                                return (\n                                                    <div className=\"item-dataset-image\" key={i}>\n                                                        <div>\n                                                            <img src={`http://127.0.0.1:5000/files/${dataset.imageFile}/${image}.jpg`} />\n                                                            <select value={assignedLabels[i]}\n                                                                    onChange={e => {setAssignedLabels(state => {\n                                                                                const stateCopy = [...state]\n                                                                            \n                                                                                stateCopy[i] = e.target.value\n                                                                            \n                                                                                return stateCopy\n                                                                            })\n                                                                            setRefreshLabels(new Date().getTime())}}>\n                                                                <option value=\"No label\">No label</option>\n                                                                {labels.map((label, j) => \n                                                                    <option value={label} key={j}>{label}</option>\n                                                                )}\n                                                            </select>\n                                                        </div>\n                                                    </div>\n                                                )\n                                            }\n                                        })}\n                                    </div>\n                                }\n                            </div>\n                            <div className=\"create-workspace-data\">\n                                <p className=\"create-workspace-data-header\">Labels:</p>\n                                <div className=\"sidebar-divided\" />\n                                <input className=\"create-dataset-label-input\"\n                                        placeholder=\"Add Label\"\n                                        onChange={e => {setAddLabel(e.target.value)}}\n                                        onKeyPress={addFunctionKey}\n                                        value={addLabel} />\n                                <div className=\"create-dataset-labels-list\">\n                                    {labels.map((label, i) => {\n                                        return (\n                                            <div className=\"create-dataset-label\" key={i}>\n                                                <p>{label}</p>\n                                                <div onClick={() => {\n                                                    assignedLabels.map((assignedLabel, j) => {\n                                                        if (assignedLabel === labels[i]) {\n                                                            setAssignedLabels(state => {\n                                                                const stateCopy = [...state]\n                                                            \n                                                                stateCopy[j] = \"No label\"\n                                                            \n                                                                return stateCopy\n                                                            })\n                                                        }\n                                                    })\n                                                    labels.splice(i, 1)\n                                                    setRefreshLabels(new Date().getTime())\n                                                }}>\n                                                    <CloseIcon className=\"create-dataset-label-icon\" /> \n                                                </div>\n                                            </div>\n                                        )\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            }\n        </>\n    )\n}\n\nexport default Dataset"]},"metadata":{},"sourceType":"module"}